<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gg.springbootvuejs.biz.dao.UpmsPermissionBizMapper">
    <resultMap id="BaseResultMap" type="com.gg.springbootvuejs.base.entity.UpmsPermission">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Mar 26 23:00:04 CST 2018.
        -->
        <id column="permission_id" jdbcType="INTEGER" property="permissionId"/>
        <result column="system_id" jdbcType="INTEGER" property="systemId"/>
        <result column="pid" jdbcType="INTEGER" property="pid"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="type" jdbcType="TINYINT" property="type"/>
        <result column="permission_value" jdbcType="VARCHAR" property="permissionValue"/>
        <result column="uri" jdbcType="VARCHAR" property="uri"/>
        <result column="icon" jdbcType="VARCHAR" property="icon"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="orders" jdbcType="BIGINT" property="orders"/>
        <result column="version" jdbcType="TINYINT" property="version"/>
        <result column="created_by" jdbcType="VARCHAR" property="createdBy"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="last_upd_by" jdbcType="VARCHAR" property="lastUpdBy"/>
        <result column="last_upd_time" jdbcType="TIMESTAMP" property="lastUpdTime"/>
    </resultMap>
    <select id="queryUserMenusByLoginId" parameterType="String" resultMap="BaseResultMap">
        select distinct(up.permission_id), up.system_id, up.pid, up.name, up.type, up.permission_value, up.uri, up.icon
        from upms_permission up
        left join upms_role_permission urp on up.permission_id = urp.permission_id
        left join upms_role ur on urp.role_id = ur.role_id
        left join upms_user_role uur on ur.role_id = uur.user_role_id
        left join upms_user uu on  uur.user_id = uu.user_id
        where uu.login_id=#{loginId} and up.status = '1'
        <![CDATA[  and up.type <> '3']]>
        order by up.permission_id asc,up.orders asc
  </select>
</mapper>